const e={23:28,33:142,43:307,53:522,63:787,73:1102,83:1467,93:1882},t=[16777215,0],n=[16777215,255,65280,16711680],r=[16777215,16711680,65280,255,16776960,65535,16711935,0];var i=class{constructor(e=``,t=3,n=200,r=!1){this.scale=Math.sin(this.degreesToRadians(60)),this.text=e,this.bits=t,this.size=n,this._unitScale=10;let i=document.createElement(`canvas`),a=i.getContext(`2d`);if(a.imageSmoothingEnabled=!1,a.globalAlpha=1,this.cvs=i,this.ctx=a,r){this._svgNamespace=`http://www.w3.org/2000/svg`;let e=document.createElementNS(this._svgNamespace,`svg`);e.setAttribute(`color-interpolation`,`sRGB`),e.setAttribute(`shape-rendering`,`crispEdges`),e.setAttribute(`style`,`forced-color-adjust: none; color-scheme: light; color: #FFFFFF; fill: #FFFFFF;`),this.svg=e}this.withSvg=r,this.change(!0)}getCvs(){return this.cvs}getSvg(){return this.svg}updateSize(e){this.size=e,this.change(!0)}updateText(e){this.text=e,this.change()}updateBits(e){this.bits=e,this.change()}change(e=!1){if(this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height),e&&(this.cvs.width=this.size*this._unitScale,this.cvs.height=this.size*this._unitScale,this.cvs.style.width=this.size+`px`,this.cvs.style.height=this.size+`px`),this.withSvg){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);e&&(this.svg.setAttribute(`width`,`${this.size}`),this.svg.setAttribute(`height`,`${this.size}`),this.svg.setAttribute(`viewBox`,`0 0 ${this.size} ${this.size}`))}this.encode()}degreesToRadians(e){return e*(Math.PI/180)}stringToBits(e){let t=new TextEncoder().encode(e),n=new Uint8Array(t.length+1);n.set(t),n[t.length]=0;let r=[0,1],i=`01`,a=[];switch(this.bits){case 3:for(let e of n)i+=e.toString(2).padStart(8,`0`);for(;i.length%3!=0;)i+=`0`;for(let e=0;e<i.length;e+=3)a.push(parseInt(i.slice(e,e+3),2));return a;case 2:for(let e of n)i+=e.toString(2).padStart(8,`0`);for(let e=0;e<i.length;e+=2)a.push(parseInt(i.slice(e,e+2),2));return a;case 1:return r.concat(Array.from(n).flatMap(e=>e.toString(2).padStart(8,`0`).split(``)).map(Number));default:}}numberToBits(e){let t=c(e),n=[0,0],r=`00`,i=[];switch(this.bits){case 3:for(let e of t)r+=e;for(;r.length%3!=0;)r+=`0`;for(let e=0;e<r.length;e+=3)i.push(parseInt(r.slice(e,e+3),2));return i;case 2:for(let e of t)r+=e;for(let e=0;e<r.length;e+=2)i.push(parseInt(r.slice(e,e+2),2));return i;case 1:return n.concat(t.split(``).map(Number));default:}}fillRandomColor(e){if(e<=0)return[];let t=2;switch(this.bits){case 3:t=8;break;case 2:t=4;break;case 1:t=2;break;default:}return Array.from({length:e},()=>Math.floor(Math.random()*t))}padDataToVersion(e,t){if(e.length>t)throw Error(`Data length (${e.length}) exceeds capacity (${t})`);return e.length<t?e.concat(this.fillRandomColor(t-e.length)):e}getRequiredVersion(t){for(let[n,r]of Object.entries(e)){let e=Number(n);if(t<=r)return{version:e,capacity:r}}throw Error(`Data length (${t}) exceeds the maximum supported tricode capacity. Maximum supported capacity: ${Math.max(...Object.values(e))}`)}encode(e=this.text){this.text=e;let i=[];i=/^\d+$/.test(e)?this.numberToBits(e):this.stringToBits(e);let{version:a,capacity:c}=this.getRequiredVersion(i.length);i=this.padDataToVersion(i,c);let l=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0];i.length>32&&l.push(0),l=l.concat(i);let u=[[0,0],[0,0],[0,0],[0,0,0],[0,0,1,0,0]],d=[[0,0,0],[0,0,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,0,1,1,0,0],[0,0,1,1,1,1,1,1,1,0,0]],f=[[0],[0,0,0]],p=0,m=0;for(;;m++){let e=[];e.push(0,0);let t=p+2*m+1;if(e.push(...l.slice(p,t)),e.push(0,0),f.push(e),t>=l.length)break;let n=2*m+2;if(p=t,l.length-t<=n*5-4){for(let e=0;e<5;e++){let t=u[e],r=p+n-(u[e].length-2);t.push(...l.slice(p,r)),t.push(...Array(n-t.length+2).fill(0)),t.push(...d[e]),f.push(t),p=r}break}}f.push(Array(2*m+17).fill(0));let h=this.size/(m+9);f.forEach((e,i)=>{let a=this.size/2-i*h/2,c=i*h,l=c*this.scale,u=(c+h)*this.scale,d=[a-h/2,u],f=[a-h,l],p=[a,l];e.forEach((e,i)=>{f=d,d=p;let c=(i&1)==0;p=c?[a+i*h/2+h/2,u]:[a+i*h/2+h/2,l];let m;switch(this.bits){case 3:m=r;break;case 2:m=n;break;default:m=t}if(o(this.ctx,d.map(e=>e*this._unitScale),f.map(e=>e*this._unitScale),p.map(e=>e*this._unitScale),s(m[e]),c),this.withSvg){let t=document.createElementNS(this._svgNamespace,`polygon`);t.setAttribute(`points`,`${d.join(`,`)} ${f.join(`,`)} ${p.join(`,`)}`),t.setAttribute(`fill`,s(m[e])),this.svg.appendChild(t)}})})}},a=1,o=(e,t,n,r,i,o=!0)=>{let[s,c]=t,[l,u]=n,[d,f]=r;e.save(),e.beginPath();let p=Math.sqrt(a*a*2);o?(e.moveTo(s,c-p),e.lineTo(l-a,u+a),e.lineTo(d+a,f+a)):(e.moveTo(s,c+p),e.lineTo(l-a,u-a),e.lineTo(d+a,f-a)),e.closePath(),e.imageSmoothingEnabled=!1,e.fillStyle=i,e.fill(),e.restore()},s=e=>`#${(e&16777215).toString(16).padStart(6,`0`).toUpperCase()}`,c=(e,t=10)=>{let n=e.length.toString(2).padStart(t,`0`),r=``,i=[];for(let t=0;t<e.length;t+=3)i.push(e.slice(t,t+3));return i.forEach(e=>{let t=parseInt(e,10),n;switch(e.length){case 3:n=t.toString(2).padStart(10,`0`);break;case 2:n=t.toString(2).padStart(7,`0`);break;case 1:n=t.toString(2).padStart(4,`0`);break;default:}r+=n}),n+r};export{i as t};