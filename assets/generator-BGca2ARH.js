var e=class{constructor(e,t=``,n=3,r=200,i=!1){this.container=e,this.scale=Math.sin(this.degreesToRadians(60)),this.text=t,this.bits=n,this.size=r,this.canvas=i,this._svgNamespace=`http://www.w3.org/2000/svg`,this._unitScale=10,this.change(!0)}updateSize(e){this.size=e,this.change(!0)}updateText(e){this.text=e,this.change()}updateBits(e){this.bits=e,this.change()}change(e=!1){if(this.canvas){let t=this.container.querySelector(`canvas`);if(t)this.ctx.clearRect(0,0,t.width,t.height);else{t=document.createElement(`canvas`);let e=t.getContext(`2d`);e.imageSmoothingEnabled=!1,e.globalAlpha=1,this.ctx=e,this.container.appendChild(t)}e&&(t.width=this.size*this._unitScale,t.height=this.size*this._unitScale,t.style.width=this.size+`px`,t.style.height=this.size+`px`),this._cvs=t}else{let t=this.container.querySelector(`svg`);if(t)for(;t.firstChild;)t.removeChild(t.firstChild);else t=document.createElementNS(this._svgNamespace,`svg`),t.setAttribute(`color-interpolation`,`sRGB`),t.setAttribute(`shape-rendering`,`crispEdges`),t.setAttribute(`style`,`forced-color-adjust: none; color-scheme: light; color: #FFFFFF; fill: #FFFFFF;`),this.container.appendChild(t);e&&(t.setAttribute(`width`,`${this.size}`),t.setAttribute(`height`,`${this.size}`),t.setAttribute(`viewBox`,`0 0 ${this.size} ${this.size}`)),this._svg=t}this.encode()}degreesToRadians(e){return e*(Math.PI/180)}stringToBits(e){let t=new TextEncoder().encode(e),n=new Uint8Array(t.length+1);n.set(t),n[t.length]=0;let r=[0,1],i=`01`,a=[];switch(this.bits){case 3:for(let e of n)i+=e.toString(2).padStart(8,`0`);for(;i.length%3!=0;)i+=`0`;for(let e=0;e<i.length;e+=3)a.push(parseInt(i.slice(e,e+3),2));return a;case 2:for(let e of n)i+=e.toString(2).padStart(8,`0`);for(let e=0;e<i.length;e+=2)a.push(parseInt(i.slice(e,e+2),2));return a;case 1:return r.concat(Array.from(n).flatMap(e=>e.toString(2).padStart(8,`0`).split(``)).map(Number));default:}}numberToBits(e){let t=s(e),n=[0,0],r=`00`,i=[];switch(this.bits){case 3:for(let e of t)r+=e;for(;r.length%3!=0;)r+=`0`;for(let e=0;e<r.length;e+=3)i.push(parseInt(r.slice(e,e+3),2));return i;case 2:for(let e of t)r+=e;for(let e=0;e<r.length;e+=2)i.push(parseInt(r.slice(e,e+2),2));return i;case 1:return n.concat(t.split(``).map(Number));default:}}fillRandomColor(e){if(e<=0)return[];let t=2;switch(this.bits){case 3:t=8;break;case 2:t=4;break;case 1:t=2;break;default:}return Array.from({length:e},()=>Math.floor(Math.random()*t))}padDataToVersion(e,t){if(e.length>t)throw Error(`Data length (${e.length}) exceeds capacity (${t})`);return e.length<t?e.concat(this.fillRandomColor(t-e.length)):e}getRequiredVersion(e){for(let[t,r]of Object.entries(n)){let n=Number(t);if(e<=r)return{version:n,capacity:r}}throw Error(`Data length (${e}) exceeds the maximum supported tricode capacity. Maximum supported capacity: ${Math.max(...Object.values(n))}`)}encode(e=this.text){this.text=e;let n=[];n=/^\d+$/.test(e)?this.numberToBits(e):this.stringToBits(e);let{version:s,capacity:c}=this.getRequiredVersion(n.length);n=this.padDataToVersion(n,c);let l=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0];n.length>32&&l.push(0),l=l.concat(n);let u=[[0,0],[0,0],[0,0],[0,0,0],[0,0,1,0,0]],d=[[0,0,0],[0,0,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,0,1,1,0,0],[0,0,1,1,1,1,1,1,1,0,0]],f=[[0],[0,0,0]],p=0,m=0;for(;;m++){let e=[];e.push(0,0);let t=p+2*m+1;if(e.push(...l.slice(p,t)),e.push(0,0),f.push(e),t>=l.length)break;let n=2*m+2;if(p=t,l.length-t<=n*5-4){for(let e=0;e<5;e++){let t=u[e],r=p+n-(u[e].length-2);t.push(...l.slice(p,r)),t.push(...Array(n-t.length+2).fill(0)),t.push(...d[e]),f.push(t),p=r}break}}f.push(Array(2*m+17).fill(0));let h=this.size/(m+9);f.forEach((e,n)=>{let s=this.size/2-n*h/2,c=n*h,l=c*this.scale,u=(c+h)*this.scale,d=[s-h/2,u],f=[s-h,l],p=[s,l];e.forEach((e,n)=>{f=d,d=p,p=n%2==0?[s+n*h/2+h/2,u]:[s+n*h/2+h/2,l];let c=r;switch(this.bits){case 3:c=a;break;case 2:c=i;break;default:c=r}if(this.canvas)t(this.ctx,[d[0]*this._unitScale,d[1]*this.scale*this._unitScale],[f[0]*this._unitScale,f[1]*this.scale*this._unitScale],[p[0]*this._unitScale,p[1]*this.scale*this._unitScale],o(c[e]));else{let t=document.createElementNS(this._svgNamespace,`polygon`);t.setAttribute(`points`,`${d.join(`,`)} ${f.join(`,`)} ${p.join(`,`)}`),t.setAttribute(`fill`,o(c[e])),this._svg.appendChild(t)}})})}},t=(e,t,n,r,i)=>{let[a,o]=t.map(e=>Math.round(e)),[s,c]=n.map(e=>Math.round(e)),[l,u]=r.map(e=>Math.round(e));e.beginPath(),e.moveTo(a,o),e.lineTo(s,c),e.lineTo(l,u),e.closePath(),e.fillStyle=i,e.fill()},n={23:28,33:142,43:307,53:522,63:787,73:1102,83:1467,93:1882},r=[16777215,0],i=[16777215,255,65280,16711680],a=[16777215,16711680,65280,255,16776960,65535,16711935,0],o=e=>`#${(e&16777215).toString(16).padStart(6,`0`).toUpperCase()}`,s=(e,t=10)=>{let n=e.length.toString(2).padStart(t,`0`),r=``,i=[];for(let t=0;t<e.length;t+=3)i.push(e.slice(t,t+3));return i.forEach(e=>{let t=parseInt(e,10),n;switch(e.length){case 3:n=t.toString(2).padStart(10,`0`);break;case 2:n=t.toString(2).padStart(7,`0`);break;case 1:n=t.toString(2).padStart(4,`0`);break;default:}r+=n}),n+r};export{e as t};