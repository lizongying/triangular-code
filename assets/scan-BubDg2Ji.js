import"./modulepreload-polyfill-DQ8RlzRK.js";window.onload=()=>{let e=document.getElementById(`webcam`),t=document.getElementById(`tip`),n=document.getElementById(`result`),r=document.getElementById(`canvas`),i=document.getElementById(`canvasContainer`),a=r.getContext(`2d`,{willReadFrequently:!0}),o=0,s=0,c=null,l=()=>{let e=i.clientWidth*window.devicePixelRatio,t=i.clientHeight*window.devicePixelRatio;r.width=e,r.height=t},u=()=>{let t=r.width,n=r.height,i=e.videoWidth/e.videoHeight,a=t/n,o=0,s=0,c=0,l=0;return i>a?(l=n,c=n*i,o=(t-c)/2):(c=t,l=t/i,s=(n-l)/2),{x:o,y:s,w:c,h:l}},d=()=>{let e=new window.AudioContext,t=e.createOscillator(),n=e.createGain();t.connect(n),n.connect(e.destination),t.frequency.setValueAtTime(1200,e.currentTime),n.gain.setValueAtTime(.1,e.currentTime),t.start(),t.stop(e.currentTime+.2)},f=()=>{if(!c)try{c=new Worker(new URL(`/tricode/assets/detector-uGoaTDZ2.js`,``+import.meta.url),{type:`module`}),c.onmessage=e=>{let t=e.data;t.success&&(n.textContent=t.text,d())},c.onerror=e=>{console.error(e),g()}}catch(e){console.error(e),c=null}};async function p(){if(!e.srcObject)try{e.srcObject=await navigator.mediaDevices?.getUserMedia({video:{facingMode:{ideal:`environment`},width:{ideal:1080},height:{ideal:1920}}}),e.onloadedmetadata=async()=>{await e.play(),l(),m()}}catch(e){console.error(e)}}let m=()=>{if(e.paused)return;a.clearRect(0,0,r.width,r.height);let i=u();a.drawImage(e,0,0,e.videoWidth,e.videoHeight,i.x,i.y,i.w,i.h);let l=Math.min(r.width,r.height)*.9,d=l*(Math.sqrt(3)/2),f=(r.width-l)/2,p=r.height/2+d/3,h=p-d;if(t.style.top=`calc(${h/y}px - 3rem)`,n.style.top=`calc(${p/y}px + 1rem)`,s++,s>=30){s=0;let e=Math.floor(l),t=Math.floor(d),n=a.getImageData(f,h,e,t);c&&c.postMessage({imageData:n.data,width:e,height:t},[n.data.buffer])}o=requestAnimationFrame(m)},h=()=>{if(!o)return;cancelAnimationFrame(o);let t=e.srcObject;t&&(t.getTracks().forEach(e=>e.stop()),e.srcObject=null)},g=()=>{c&&=(c.terminate(),null)};window.addEventListener(`pageshow`,()=>{f(),p().then()}),window.addEventListener(`beforeunload`,()=>{h(),g()});let _=document.getElementById(`maskCanvas`),v=_.getContext(`2d`),y=window.devicePixelRatio||1,b=()=>{let e=window.innerWidth,t=window.innerHeight;_.width=e*y,_.height=t*y,_.style.width=`${e}px`,_.style.height=`${t}px`,v.scale(y,y);let n=Math.min(e,t)*.9,r=n*(Math.sqrt(3)/2),i=(e-n)/2,a=t/2+r/3,o=(e+n)/2,s=a,c=e/2,l=a-r;v.fillStyle=`rgba(0, 0, 0, 0.7)`,v.fillRect(0,0,e,t),v.save(),v.strokeStyle=`#ffffff`,v.lineWidth=1,v.beginPath(),v.moveTo(i,a),v.lineTo(o,s),v.lineTo(c,l),v.closePath(),v.stroke(),v.beginPath(),v.moveTo(i,a),v.lineTo(o,s),v.lineTo(c,l),v.closePath(),v.globalCompositeOperation=`destination-out`,v.fill(),v.restore()};f(),p().then(),b(),window.addEventListener(`resize`,()=>{l(),b()})};