var e=class{constructor(e,t=``,n=3,r=200){this.container=e,this.scale=Math.sin(this.degreesToRadians(60)),this._svgNamespace=`http://www.w3.org/2000/svg`,this.bits=n,this.text=t,this.updateSize(r)}updateSize(e){this.size=e;let t=this.container,n=t.querySelector(`svg`);if(n)for(;n.firstChild;)n.removeChild(n.firstChild);else n=document.createElementNS(this._svgNamespace,`svg`),n.setAttribute(`transform`,`scale(1,${this.scale})`),t.attachShadow({mode:`open`}).appendChild(n);n.setAttribute(`width`,`${e}`),n.setAttribute(`height`,`${e}`),n.setAttribute(`viewBox`,`0 0 ${e} ${e}`),n.setAttribute(`style`,`forced-color-adjust: none; color: #FFFFFF; fill: #FFFFFF;`),this._svg=n,this.encode()}updateText(e){this.text=e;let t=this.container,n=t.querySelector(`svg`);if(n)for(;n.firstChild;)n.removeChild(n.firstChild);else n=document.createElementNS(this._svgNamespace,`svg`),n.setAttribute(`transform`,`scale(1,${this.scale})`),t.appendChild(n);this._svg=n,this.encode()}updateColor(e){this.bits=e;let t=this.container,n=t.querySelector(`svg`);if(n)for(;n.firstChild;)n.removeChild(n.firstChild);else n=document.createElementNS(this._svgNamespace,`svg`),n.setAttribute(`transform`,`scale(1,${this.scale})`),t.appendChild(n);this._svg=n,this.encode()}degreesToRadians(e){return e*(Math.PI/180)}stringToBits(e){let t=new TextEncoder().encode(e),n=new Uint8Array(t.length+1);n.set(t),n[t.length]=0;let r=[0,1];switch(this.bits){case 3:{let e=`01`;for(let t of n)e+=t.toString(2).padStart(8,`0`);for(;e.length%3!=0;)e+=`0`;let t=[];for(let n=0;n<e.length;n+=3)t.push(parseInt(e.slice(n,n+3),2));return t}case 2:{let e=`01`;for(let t of n)e+=t.toString(2).padStart(8,`0`);let t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),2));return t}default:return r.concat(Array.from(n).flatMap(e=>e.toString(2).padStart(8,`0`).split(``)).map(Number))}}numberToBits(e){let t=o(e),n=[0,0];switch(this.bits){case 3:{let e=`00`;for(let n of t)e+=n;for(;e.length%3!=0;)e+=`0`;let n=[];for(let t=0;t<e.length;t+=3)n.push(parseInt(e.slice(t,t+3),2));return n}case 2:{let e=`00`;for(let n of t)e+=n;let n=[];for(let t=0;t<e.length;t+=2)n.push(parseInt(e.slice(t,t+2),2));return n}default:return n.concat(t.split(``).map(Number))}}defaultColor(){let e=n;switch(this.bits){case 3:e=8;break;case 2:e=4;break;default:e=2}return Math.floor(Math.random()*e)}fillRandomColor(e){if(e<=0)return[];let t=2;switch(this.bits){case 3:t=8;break;case 2:t=4;break;case 1:t=2;break;default:t=2}return Array.from({length:e},()=>Math.floor(Math.random()*t))}padDataToVersion(e,n){let r=t[n];if(!r)throw Error(`Unsupported TC version: ${n}`);if(e.length>r)throw Error(`Data length (${e.length}) exceeds capacity (${r}) for TC version ${n}`);return e.length<r?e.concat(this.fillRandomColor(r-e.length)):e}getRequiredVersion(e){for(let[n,r]of Object.entries(t)){let t=Number(n);if(e<=r)return{version:t,capacity:r}}throw Error(`Data length (${e}) exceeds the maximum supported TC capacity. Maximum supported capacity: ${Math.max(...Object.values(t))}`)}encode(e=this.text){this.text=e;let t=[];t=/^\d+$/.test(e)?this.numberToBits(e):this.stringToBits(e),console.log(`data`,t);let{version:o,capacity:s}=this.getRequiredVersion(t.length);console.log(`version: ${o}, capacity: ${s}`),t=this.padDataToVersion(t,o);let c=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0];t.length>32&&c.push(0),c=c.concat(t);let l=[[0,0,0],[0,0,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,0,1,1,0,0],[0,0,1,1,1,1,1,1,1,0,0]],u=[[0],[0,0,0]],d=0,f=0;for(;;f++){let e=[];e.push(0,0);let t=d+2*f+1;if(e.push(...c.slice(d,t)),e.push(0,0),u.push(e),t>=c.length)break;let n=2*f+2;if(d=t,c.length-t<=n*5){for(let e=0;e<5;e++){let t=[];t.push(0,0);let r=d+n;t.push(...c.slice(d,r)),t.push(...Array(n-t.length+2).fill(0)),t.push(...l[e]),u.push(t),d=r}break}}u.push(Array(2*f+17).fill(0));let p=this.size/(f+9);u.forEach((e,t)=>{let o=this.size/2-t*p/2,s=t*p;e.forEach((e,t)=>{let c,l,u;t%2==0?(c=[o+t*p/2,s],l=[o+t*p/2-p/2,s+p],u=[o+(t*p/2+p/2),s+p]):(c=[o+t*p/2,s+p],l=[o+t*p/2-p/2,s],u=[o+(t*p/2+p/2),s]);let d=document.createElementNS(this._svgNamespace,`polygon`);d.setAttribute(`points`,`${c.join(`,`)} ${l.join(`,`)} ${u.join(`,`)}`);let f=n;switch(this.bits){case 3:f=i;break;case 2:f=r;break;default:f=n}d.setAttribute(`fill`,a(f[e])),this._svg.appendChild(d)})})}},t={23:32,33:146,43:311,53:526,63:791,73:1106,83:1471,93:1886},n=[16777215,0],r=[16777215,255,65280,16711680],i=[16777215,16711680,65280,255,16776960,65535,16711935,0],a=e=>`#${(e&16777215).toString(16).padStart(6,`0`).toUpperCase()}`,o=(e,t=10)=>{let n=e.length.toString(2).padStart(t,`0`),r=``,i=[];for(let t=0;t<e.length;t+=3)i.push(e.slice(t,t+3));return i.forEach(e=>{let t=parseInt(e,10),n;switch(e.length){case 3:n=t.toString(2).padStart(10,`0`);break;case 2:n=t.toString(2).padStart(7,`0`);break;case 1:n=t.toString(2).padStart(4,`0`);break;default:throw Error(`分組異常，請檢查輸入`)}r+=n}),n+r};export{e as t};